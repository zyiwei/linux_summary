# 软件RAID配置

### MDADM
在Linux中RAID通过MDADM程序实现
支持RAID0,1,4,5,6
MDADM可以基于多块硬盘、分区或逻辑卷创建软件RAID
创建好的软件RAID对应/dev/mdn
RAID信息保存在/proc/mdstat文件中，或通过mdadm命令查看

创建RAID 0:
mdadm -C /dev/md0 -a yes -l 0 -n 2 /dev/sdb /dev/sdc
-C 创建一个新的RAID
-a 自动创建对应设备
-l 指定要创建的RAID级别
-n 指定硬盘的容量

创建文件系统后挂载使用：
mkfs.ext4 /dev/md0
mount /dev/md0 /mnt
创建好RAID之后，需要创建一个配置文件，使RAID保存下来，重启后依然有效：
mdadm -D --scan > /etc/mdadm.conf
重启自动挂载：
vim /etc/fstab

查看RAID信息：
mdadm -D /dev/md0
cat /proc/mdstat

创建RAID1:
mdadm -C /dev/md0 -a yes -l 1 -n 2 /dev/sdb /dev/sdc
创建RAID5:
mdadm -C /dev/md0 -a yes -l 5 -n 3 /dev/sdb /dev/sdc /dev/sdd
创建RAID6:
mdadm -C /dev/md0 -a yes -l 6 -n 4 /dev/sdb /dev/sdc /dev/sdd /dev/sde

指定一个备份磁盘，当出现磁盘故障时，指定的备份磁盘可以自动上线工作：
mdadm -C /dev/md0 -a yes -l 5 -n 3 -x 1 /dev/sdb /dev/sdc /dev/sdd /dev/sde

### 控制RAID
关闭RAID（关闭前卸载）：
mdadm -S /dev/md0
启用指定RAID:
mdadm -R /dev/md

关闭RAID后，底层磁盘仍保存有RAID信息
彻底清除RAID信息
mdadm --zero-superblock /dev/sdb
mdadm --zero-superblock /dev/sdc

如果创建RAID5、6速度比较慢
使用cat /proc/mdstat命令查看进度，进度条结束时才可使用

### 模拟故障
模拟一个磁盘的故障：
mdadm /dev/md0 -f /dev/sdb
将故障磁盘移除：
mdadm /dev/md0 -r /dev/sdb
换上新磁盘后，将新硬盘添加到RAID中：
mdadm /dev/md0 -a /dev/md0